

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ways.base.situation &mdash; Ways 1.0.0b1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'1.0.0b1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Ways
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../why.html">Why</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../descriptors.html">Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugin_basics.html">Plugin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugin_advanced.html">Advanced Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../parsing.html">Parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_details.html">API Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../common_patterns.html">Common Patterns And Best Practices</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../summary.html">API Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ways.html">API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Ways</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../ways.html">ways</a> &raquo;</li>
        
      <li>ways.base.situation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ways.base.situation</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;The most important part of Ways - A module that contains Context objects.</span>

<span class="sd">Context objects are persistent objects that are created</span>
<span class="sd">using a Flyweight pattern. Once one instance of a Context is created, it is</span>
<span class="sd">reused whenever the same Context is called again - which means it can be</span>
<span class="sd">used like a monostate.</span>

<span class="sd">Reference:</span>
<span class="sd">    http://sourcemaking.com/design_patterns/flyweight</span>
<span class="sd">    http://sourcemaking.com/design_patterns/flyweight/python/1</span>

<span class="sd">The Python example is written in Python 3 but is the same idea.</span>

<span class="sd">Parts of the Context are generated at runtime and cannot be directly</span>
<span class="sd">modified (like, for example, its Plugin objects). Other parts are dynamic (like</span>
<span class="sd">the Context.data property).</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="c1"># IMPORT STANDARD LIBRARIES</span>
<span class="c1"># scspell-id: 3c62e4aa-c280-11e7-be2b-382c4ac59cfd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="c1"># IMPORT THIRD-PARTY LIBRARIES</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">moves</span>

<span class="c1"># IMPORT WAYS LIBRARIES</span>
<span class="kn">import</span> <span class="nn">ways</span>

<span class="c1"># IMPORT LOCAL LIBRARIES</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">finder</span> <span class="k">as</span> <span class="n">find</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">factory</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">connection</span> <span class="k">as</span> <span class="n">conn</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="k">import</span> <span class="n">pathrip</span>
<span class="kn">from</span> <span class="nn">..helper</span> <span class="k">import</span> <span class="n">common</span>
<span class="kn">from</span> <span class="nn">..parsing</span> <span class="k">import</span> <span class="n">parse</span>


<div class="viewcode-block" id="Context"><a class="viewcode-back" href="../../../situation.html#ways.api.Context">[docs]</a><span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A collection of plugins that are read in order to resolve its methods.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create the instance and store its location in the Ways hierarchy.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            data (dict[str]):</span>
<span class="sd">                Completely arbitrary information that the user can customize</span>
<span class="sd">                and store anything on. Because Context objects are Flyweights,</span>
<span class="sd">                this information will persist no matter where this Context is</span>
<span class="sd">                called.</span>

<span class="sd">        Args:</span>
<span class="sd">            hierarchy (tuple[str] or str):</span>
<span class="sd">                The location to look for our instance. This location will be</span>
<span class="sd">                used to sort and cache our instance once its class is defined.</span>
<span class="sd">            assignment (str):</span>
<span class="sd">                The category/grouping of the instance. Default: &#39;&#39;.</span>
<span class="sd">            connection</span>
<span class="sd">                (:obj:`dict[str, callable[list[:class:`ways.api.Plugin`]]]`,</span>
<span class="sd">                    optional):</span>
<span class="sd">                Context objects are built out of Plugin objects that are defined</span>
<span class="sd">                and retrieved at runtime. Since most Context objects are built</span>
<span class="sd">                of more than one Plugin, we need to know how to merge</span>
<span class="sd">                Plugin objects so that we can get a single value.</span>
<span class="sd">                This attribute, connection, describes how Context</span>
<span class="sd">                objects resolve. Default: context_connection_info().</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                If a part of a hierarchy has bad characters</span>
<span class="sd">                (characters that are not alpha-numeric or [-| |_|/]).</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Context</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">split_hierarchy</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">)</span>

        <span class="c1"># Check each term in the hierarchy for bad characters</span>
        <span class="n">bad_characters_comp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9_\-/ ]+&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">hierarchy</span><span class="p">:</span>
            <span class="n">bad_characters</span> <span class="o">=</span> <span class="n">bad_characters_comp</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bad_characters</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Bad characters: &quot;</span><span class="si">{chars}</span><span class="s1">&quot; in hierarchy, &quot;</span><span class="si">{hier}</span><span class="s1">&quot;.&#39;</span>
                    <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chars</span><span class="o">=</span><span class="n">bad_characters</span><span class="p">,</span> <span class="n">hier</span><span class="o">=</span><span class="n">hierarchy</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">context_connection_info</span><span class="p">()</span>

        <span class="c1"># TODO : Deprecate self.assignment and self.hierarchy - since these</span>
        <span class="c1">#        probably will not change</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignment</span> <span class="o">=</span> <span class="n">assignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">find</span><span class="o">.</span><span class="n">Find</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">hierarchy</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_data</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;dict[str]: Data that was automatically generated and user data.&#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_data</span><span class="p">())</span>
        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the user data to whatever the given value is.</span>

<span class="sd">        Note:</span>
<span class="sd">            This function cannot modify the data that was generated from the</span>
<span class="sd">            plugins for this Context - that data is read-only.</span>

<span class="sd">        Args:</span>
<span class="sd">            dict[str]: The new user data.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_data</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_init_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;dict[str]: The default data on a Context.&#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_left_right_priority</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find all of the &quot;valid&quot; plugins for this instance.</span>

<span class="sd">        What decides if a Plugin is &quot;found&quot; depends on a number of factors.</span>
<span class="sd">        First, the plugin needs to be inside the hierarchy of the Context,</span>
<span class="sd">        have the same assignment, and the platform(s) assigned to the Plugin</span>
<span class="sd">        must match our current system&#39;s platform. If a platform override is</span>
<span class="sd">        specified (aka if WAYS_PLATFORM has been set) then the Plugin</span>
<span class="sd">        object&#39;s platform has to match that, instead.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the platform in WAYS_PLATFORM was invalid.</span>
<span class="sd">            ValueError: If the plugin found has a platform that is not found</span>
<span class="sd">                        in our recognized_platforms variable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[:class:`ways.api.Plugin`]: The found plugins.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_plugins</span><span class="p">(</span>
            <span class="n">hierarchy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assignment</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_plugin</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">EnvironmentError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="Context.get_action"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_action">[docs]</a>    <span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:class:`ways.api.Action` or callable or NoneType: The Action.&#39;&#39;&#39;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">ways</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">hierarchy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assignment</span><span class="p">)</span>

        <span class="c1"># If this object is a class, then assume that it&#39;s a ways.api.Action</span>
        <span class="c1"># and that it needs to be instantiated so that we can run __call__ on it</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">action</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">action</span></div>

<div class="viewcode-block" id="Context.get_all_plugins"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_all_plugins">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hierarchy</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;list[:class:`ways.api.Plugin`]: The found plugins, if any.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hierarchy</span><span class="p">:</span>
            <span class="n">hierarchy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">assignment</span><span class="p">:</span>
            <span class="n">assignment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment</span>

        <span class="k">return</span> <span class="n">ways</span><span class="o">.</span><span class="n">get_plugins</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="p">)</span></div>

<div class="viewcode-block" id="Context.get_assignment"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_assignment">[docs]</a>    <span class="k">def</span> <span class="nf">get_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;str: The assignment for this Context.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment</span></div>

<div class="viewcode-block" id="Context.get_hierarchy"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_hierarchy">[docs]</a>    <span class="k">def</span> <span class="nf">get_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;tuple[str]: The path to this Context.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span></div>

<div class="viewcode-block" id="Context.get_parser"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_parser">[docs]</a>    <span class="k">def</span> <span class="nf">get_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:class:`ways.api.ContextParser`: A parser copy that points to this Context.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">parse</span><span class="o">.</span><span class="n">ContextParser</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Context.get_str"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_str">[docs]</a>    <span class="k">def</span> <span class="nf">get_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the Context&#39;s mapping as filled-out text.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args (list): Positional args to send to ways.api.ContextParser.get_str.</span>
<span class="sd">            **kwargs (dict): Keyword args to send to ways.api.ContextParser.get_str.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">parse</span><span class="o">.</span><span class="n">ContextParser</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Context.get_mapping_details"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_mapping_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_mapping_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the information that describes a Context instance&#39;s mapping.</span>

<span class="sd">        This function is the same as &quot;mapping_details&quot; key that you&#39;d see in a</span>
<span class="sd">        Plugin Sheet file and is critical to how a Context&#39;s parser builds</span>
<span class="sd">        into a file path.</span>

<span class="sd">        Without it, you cannot get a proper filepath out of a Context.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str]: The information.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;get_mapping_details&#39;</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Context.get_mapping_tokens"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_mapping_tokens">[docs]</a>    <span class="k">def</span> <span class="nf">get_mapping_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;list[str]: Get all of the tokens that are in this Context&#39;s mapping.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mapping</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">parse</span><span class="o">.</span><span class="n">find_tokens</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="Context.get_all_tokens"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_all_tokens">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the tokens in this Context&#39;s mapping and any subtokens.</span>

<span class="sd">        Subtokens are tokens that are inside another token&#39;s mapping.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: All of the tokens known to this Context.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mapping_tokens</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mapping_details</span><span class="p">()):</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mapping&#39;</span><span class="p">)</span>
            <span class="n">tokens</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mapping_tokens</span><span class="p">(</span><span class="n">mapping</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">tokens</span></div>

<div class="viewcode-block" id="Context.validate_plugin"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.validate_plugin">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_plugin</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">plugin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check if a plugin is &quot;valid&quot; for this Context.</span>

<span class="sd">        Typically, a plugin is invalid if it was meant for a different OS</span>
<span class="sd">        (example), a Windows plugin shouldn&#39;t be added to a Context that is</span>
<span class="sd">        being run on a Linux machine.</span>

<span class="sd">        Args:</span>
<span class="sd">            plugin (:class:`ways.api.Plugin`): The plugin to check.</span>

<span class="sd">        Raises:</span>
<span class="sd">            OSError:</span>
<span class="sd">                If the user specified an unrecognized environment using the</span>
<span class="sd">                PLATFORM_ENV_VAR environment variable.</span>
<span class="sd">            EnvironmentError:</span>
<span class="sd">                If the plugin&#39;s environment does not match this environment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`ways.api.Plugin`: The plugin (completely unmodified).</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">recognized_platforms</span> <span class="o">=</span> <span class="n">ways</span><span class="o">.</span><span class="n">get_known_platfoms</span><span class="p">()</span>

        <span class="n">current_platform</span> <span class="o">=</span> <span class="n">get_current_platform</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">current_platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">recognized_platforms</span><span class="p">:</span>
            <span class="n">system_platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
                <span class="s1">&#39;Found platform: &quot;</span><span class="si">{platform_}</span><span class="s1">&quot; was invalid. Options were, &#39;</span>
                <span class="s1">&#39;&quot;</span><span class="si">{opt}</span><span class="s1">&quot;. Detected system platform was: &quot;</span><span class="si">{d_plat}</span><span class="s1">&quot;.&#39;</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">platform_</span><span class="o">=</span><span class="n">current_platform</span><span class="p">,</span>
                          <span class="n">opt</span><span class="o">=</span><span class="n">recognized_platforms</span><span class="p">,</span>
                          <span class="n">d_plat</span><span class="o">=</span><span class="n">system_platform</span><span class="p">))</span>

        <span class="c1"># Filter plugins if the its platform does not match our expected platforms</span>
        <span class="n">platform_aliases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;everything&#39;</span><span class="p">}</span>
        <span class="n">plug_platforms</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">get_platforms</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>

        <span class="c1"># Prevent a Plugin that has a bad-formatted platform from being filtered</span>
        <span class="k">if</span> <span class="n">plug_platforms</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">plug_platforms</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>

        <span class="n">plug_platforms</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">split_by_comma</span><span class="p">(</span>
            <span class="n">plug_platforms</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>

        <span class="c1"># If the Plugin has some syntax that means &quot;Just use this</span>
        <span class="c1"># for every platform&quot; then add the plugin to output_plugins</span>
        <span class="c1">#</span>
        <span class="n">use_all_platforms</span> <span class="o">=</span> <span class="n">platform_aliases</span> <span class="o">&amp;</span> <span class="n">plug_platforms</span>
        <span class="k">if</span> <span class="n">use_all_platforms</span><span class="p">:</span>
            <span class="n">plug_platforms</span> <span class="o">=</span> <span class="n">recognized_platforms</span>

        <span class="k">if</span> <span class="n">current_platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plug_platforms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span>
                <span class="s1">&#39;Platform: &quot;</span><span class="si">{plat}</span><span class="s1">&quot; was not found in any options, &quot;</span><span class="si">{opt}</span><span class="s1">&quot;.&#39;</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plat</span><span class="o">=</span><span class="n">current_platform</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="n">plug_platforms</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">plugin</span></div>

<div class="viewcode-block" id="Context.checkout"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.checkout">[docs]</a>    <span class="k">def</span> <span class="nf">checkout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Make a new Context instance and return it, with the same hierarchy.</span>

<span class="sd">        Args:</span>
<span class="sd">            assignment (:obj:`str`, optional): The new assignment to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`ways.api.Context`: The new Context object.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">get_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_hierarchy</span><span class="p">(),</span> <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">)</span></div>

<div class="viewcode-block" id="Context.revert"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.revert">[docs]</a>    <span class="k">def</span> <span class="nf">revert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the data on this instance back to its default.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_data</span><span class="p">()</span></div>

<div class="viewcode-block" id="Context.as_dict"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changes</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Convert this object into a dictionary.</span>

<span class="sd">        This is different from a standard repr(Context) because</span>
<span class="sd">        it will include items that are not part of the Context&#39;s initialization.</span>

<span class="sd">        It also creates a deepcopy of its contents, so that any changes to</span>
<span class="sd">        this dictionary won&#39;t affect the original object.</span>

<span class="sd">        Args:</span>
<span class="sd">            changes (:obj:`bool`, optional):</span>
<span class="sd">                If True, the output will contain original plugin data as well</span>
<span class="sd">                as any changes that the user made over top of the original.</span>
<span class="sd">                If False, only the original information is returned.</span>
<span class="sd">                Default is True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str]: A copy of the current information of this class.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;assignment&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment</span><span class="p">,</span>
            <span class="s1">&#39;actions&#39;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ways</span><span class="o">.</span><span class="n">get_actions_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_hierarchy</span><span class="p">())),</span>
            <span class="s1">&#39;connection&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span>
            <span class="s1">&#39;hierarchy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_data</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Context.get_groups"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_groups">[docs]</a>    <span class="k">def</span> <span class="nf">get_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;tuple[str]: The groups that this Context belongs to.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;get_groups&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span></div>

<div class="viewcode-block" id="Context.is_path"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.is_path">[docs]</a>    <span class="k">def</span> <span class="nf">is_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;bool: If the user indicated that the given mapping is a filepath.&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">is_path</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Context.get_mapping"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_mapping">[docs]</a>    <span class="k">def</span> <span class="nf">get_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;str: The mapping that describes this Context.&#39;&#39;&#39;</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;get_mapping&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path</span><span class="p">():</span>
            <span class="c1"># TODO : Make a good function here to check if a \ is &quot;escaped&quot;</span>
            <span class="k">if</span> <span class="n">get_current_platform</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;windows&#39;</span><span class="p">:</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mapping</span></div>

<div class="viewcode-block" id="Context.get_max_folder"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_max_folder">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;str: The highest mapping point that this Context lives in.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;get_max_folder&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span></div>

<div class="viewcode-block" id="Context.get_platforms"><a class="viewcode-back" href="../../../situation.html#ways.api.Context.get_platforms">[docs]</a>    <span class="k">def</span> <span class="nf">get_platforms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get The OSes that this Context runs on.</span>

<span class="sd">        The recognized platforms for this method is anything that platform.system()</span>
<span class="sd">        would return. (Examples: [&#39;darwin&#39;, &#39;java&#39;, &#39;linux&#39;, &#39;windows&#39;]).</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: The platforms that this Context is allowed to run on.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;get_platforms&#39;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;str: The full representation of this object.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{cls_}</span><span class="s2">(hierarchy=&#39;</span><span class="si">{hier}</span><span class="s2">&#39;, assignment=</span><span class="si">{ass}</span><span class="s2">, data=</span><span class="si">{data}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">cls_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">hier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">,</span>
            <span class="n">ass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assignment</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;str: A simple representation of this object.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{cls_}</span><span class="s2">(hierarchy=&#39;</span><span class="si">{hier}</span><span class="s2">&#39;, assignment=</span><span class="si">{ass}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">cls_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">hier</span><span class="o">=</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">HIERARCHY_SEP</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">),</span>
            <span class="n">ass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assignment</span><span class="p">,</span>
        <span class="p">)</span></div>


<span class="n">__FACTORY</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">AliasAssignmentFactory</span><span class="p">(</span><span class="n">Context</span><span class="p">)</span>


<span class="nd">@common</span><span class="o">.</span><span class="n">memoize</span>
<span class="k">def</span> <span class="nf">context_connection_info</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Get a default description of how attributes combine in a Context object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, callable[:class:`ways.api.Plugin`]]:</span>
<span class="sd">            Functions used to resolve a number of Plugins into a single output.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_get_latest_plugins</span><span class="p">(</span><span class="n">plugins</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the latest plugins of any group of hierarchies.</span>

<span class="sd">        To keep relative plugins that have the same hierarchy from</span>
<span class="sd">        stacking and yielding bad results, we check which plugins were</span>
<span class="sd">        defined in which hierarchies and get the last-defined of each</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">hierarchies</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">plugins</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;get_hierarchy&#39;</span><span class="p">)):</span>
            <span class="n">hierarchies</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">get_hierarchy</span><span class="p">(),</span> <span class="p">[])</span>
            <span class="n">hierarchies</span><span class="p">[</span><span class="n">plugin</span><span class="o">.</span><span class="n">get_hierarchy</span><span class="p">()]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">plugins_</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">itervalues</span><span class="p">(</span><span class="n">hierarchies</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugins_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">get_platforms_lowered</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Try to catch formatting issues with platforms by lowering them.</span>

<span class="sd">        platform.system() is what we use to validate if platforms are</span>
<span class="sd">        correctly written and each of its options are all in lower case</span>
<span class="sd">        so we&#39;ll intentionally lowercase our OSes, here.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (:class:`ways.api.Plugin`): The plugin to get the platforms of.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The lowered platform name.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">platforms</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_platforms</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
            <span class="n">platforms</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ways</span><span class="o">.</span><span class="n">get_known_platfoms</span><span class="p">())</span>
            <span class="n">platforms</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="n">obj_type</span> <span class="o">=</span> <span class="n">platforms</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">return</span> <span class="n">obj_type</span><span class="p">([</span><span class="n">platform_</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">platform_</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_mapping</span><span class="p">(</span><span class="n">plugins</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the mapping of our plugins and resolve it to absolute, if needed.</span>

<span class="sd">        If the latest plugin in our list of plugins is absolute, just return</span>
<span class="sd">        its mapping. If not though, then that means the plugin is relative and</span>
<span class="sd">        we must instead resolve the mapping into absolute again.</span>

<span class="sd">        Args:</span>
<span class="sd">            plugins (list[:class:`ways.api.Plugin`]):</span>
<span class="sd">                The plugin to get the mapping of.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If there is no absolute plugin in our list of plugins,</span>
<span class="sd">                          this function cannot be resolved into absolute.</span>
<span class="sd">            RuntimeError: If not a single plugin provided has a mapping.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The resolved mapping.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">build_appended_mapping</span><span class="p">(</span><span class="n">plugins</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Resolve a group of relative plugins into a single mapping.</span>

<span class="sd">            Args:</span>
<span class="sd">                plugins (list[:class:`ways.api.Plugin`]):</span>
<span class="sd">                    The plugins to create a single mapping.</span>

<span class="sd">            Returns:</span>
<span class="sd">                str: A single, relative mapping for a group of plugins.</span>

<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">appended_mapping</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">_get_latest_plugins</span><span class="p">(</span><span class="n">plugins</span><span class="p">):</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_mapping</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">common</span><span class="o">.</span><span class="n">PARENT_TOKEN</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
                    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">PARENT_TOKEN</span><span class="p">,</span> <span class="n">appended_mapping</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mapping</span> <span class="o">=</span> <span class="n">appended_mapping</span> <span class="o">+</span> <span class="n">mapping</span>
                <span class="n">appended_mapping</span> <span class="o">=</span> <span class="n">mapping</span>

            <span class="k">return</span> <span class="n">appended_mapping</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;No plugins were found. If you are using a custom assignment, &#39;</span>
                <span class="s1">&#39;make sure that the assignment is listed in WAYS_PRIORITY or it &#39;</span>
                <span class="s1">&#39;may have been skipped.&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">latest_absolute_plugin</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="n">plugin</span> <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">plugins</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_uses</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This should not happen. Every plugin found was &#39;</span>
                               <span class="s1">&#39;a relative plugin. No absolute (root) plugin &#39;</span>
                               <span class="s1">&#39;was found.&#39;</span><span class="p">)</span>

        <span class="n">abs_index</span> <span class="o">=</span> <span class="n">plugins</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">latest_absolute_plugin</span><span class="p">)</span>

        <span class="c1"># In order to resolve the absolute mapping, we need a root path to use</span>
        <span class="n">base_mapping</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_right_most_priority</span><span class="p">(</span>
            <span class="n">plugins</span><span class="p">[:</span><span class="n">abs_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;get_mapping&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">base_mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;None of the plugins provided have mappings. Cannot continue.&#39;</span><span class="p">)</span>

        <span class="c1"># TODO : Can&#39;t we move this block above base_mapping?</span>
        <span class="c1"># The resolved mapping came from an absolute plugin</span>
        <span class="c1"># so we can just return it</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">plugins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">latest_absolute_plugin</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base_mapping</span>

        <span class="c1"># Make a single, relative mapping from a group of relative Plugins</span>
        <span class="n">appended_mapping</span> <span class="o">=</span> <span class="n">build_appended_mapping</span><span class="p">(</span><span class="n">plugins</span><span class="p">[</span><span class="n">abs_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

        <span class="c1"># Try to add our parent mapping into the relative mapping wherever</span>
        <span class="c1"># the user says to do it. Otherwise, just append it</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">common</span><span class="o">.</span><span class="n">PARENT_TOKEN</span> <span class="ow">in</span> <span class="n">appended_mapping</span><span class="p">:</span>
            <span class="c1"># Do not use format (because there may be tokens like {root/{JOB}})</span>
            <span class="c1"># In this mapping</span>
            <span class="c1">#</span>
            <span class="c1"># If you use a default formatter class then I guess it&#39;d be OK</span>
            <span class="c1">#</span>
            <span class="n">resolved_mapping</span> <span class="o">=</span> <span class="n">appended_mapping</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">PARENT_TOKEN</span><span class="p">,</span> <span class="n">base_mapping</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resolved_mapping</span> <span class="o">=</span> <span class="n">base_mapping</span> <span class="o">+</span> <span class="n">appended_mapping</span>

        <span class="k">return</span> <span class="n">resolved_mapping</span>

    <span class="k">def</span> <span class="nf">get_max_folder</span><span class="p">(</span><span class="n">plugins</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the max folder that this Context is allowed to move into.</span>

<span class="sd">        Args:</span>
<span class="sd">            plugins (list[:class:`ways.api.Plugin`]): The plugins to use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The furthest up that this Context is allowed to move.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">startswith_iterable</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">startswith</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Check if every element of an iterable partially matches another.</span>

<span class="sd">            It&#39;s like &#39;asdfd&#39;.startswith(&#39;a&#39;), but for lists. Use this instead</span>
<span class="sd">            of set().issubset() if you need to keep position of the iterables.</span>

<span class="sd">            Args:</span>
<span class="sd">                root (iterable): The bigger item.</span>
<span class="sd">                startswith (iterable):</span>
<span class="sd">                    The smaller item that we want to check if it is a subset</span>
<span class="sd">                    of root.</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool: If the first iterable starts with the second element.</span>

<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">startswith</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">root_item</span><span class="p">,</span> <span class="n">starts_item</span> <span class="ow">in</span> <span class="n">moves</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">startswith</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">root_item</span> <span class="o">!=</span> <span class="n">starts_item</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">max_folders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">plugins</span><span class="p">:</span>
            <span class="n">plugin_max_folder</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_max_folder</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">plugin_max_folder</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">max_folders</span><span class="p">:</span>
                <span class="n">max_folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin_max_folder</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">recent_max_folder</span> <span class="o">=</span> <span class="n">max_folders</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># To deal with poorly formatted folder input, we normalize the</span>
            <span class="c1"># paths and then split them by &#39;/&#39; and &#39;\&#39; before comparing them</span>
            <span class="c1">#</span>
            <span class="n">plugin_max</span> <span class="o">=</span> <span class="n">pathrip</span><span class="o">.</span><span class="n">split_path_asunder</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">plugin_max_folder</span><span class="p">))</span>
            <span class="n">recent_max</span> <span class="o">=</span> <span class="n">pathrip</span><span class="o">.</span><span class="n">split_path_asunder</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">recent_max_folder</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">startswith_iterable</span><span class="p">(</span><span class="n">plugin_max</span><span class="p">,</span> <span class="n">recent_max</span><span class="p">):</span>
                <span class="c1"># If the next folder is a more detailed version of the first,</span>
                <span class="c1"># just replace the most recent folder</span>
                <span class="c1">#</span>
                <span class="n">max_folders</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">plugin_max_folder</span>
            <span class="k">elif</span> <span class="n">max_folders</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">plugin_max_folder</span><span class="p">:</span>
                <span class="n">max_folders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin_max_folder</span><span class="p">)</span>

        <span class="c1"># Normalize and return our absolute max-folder path</span>
        <span class="n">joined</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">max_folders</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">joined</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">joined</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;get_groups&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">get_right_most_priority</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;get_groups&#39;</span><span class="p">)),</span>

        <span class="s1">&#39;get_mapping&#39;</span><span class="p">:</span> <span class="n">get_mapping</span><span class="p">,</span>

        <span class="s1">&#39;get_mapping_details&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">get_left_right_priority</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;get_mapping_details&#39;</span><span class="p">)),</span>

        <span class="s1">&#39;get_max_folder&#39;</span><span class="p">:</span> <span class="n">get_max_folder</span><span class="p">,</span>

        <span class="s1">&#39;get_platforms&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">get_intersection_priority</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">get_platforms_lowered</span><span class="p">),</span>

        <span class="s1">&#39;get_skip_to&#39;</span><span class="p">:</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_right_most_priority</span><span class="p">,</span>
    <span class="p">}</span>


<div class="viewcode-block" id="get_all_contexts"><a class="viewcode-back" href="../../../situation.html#ways.api.get_all_contexts">[docs]</a><span class="k">def</span> <span class="nf">get_all_contexts</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Get or Create every Context instance that has plugins.</span>

<span class="sd">    Warning:</span>
<span class="sd">        This method can potentially be slow if there are a lot of Context</span>
<span class="sd">        objects left to be defined. That said, the second time this method</span>
<span class="sd">        is called, it&#39;ll be fast because the Context instances will</span>
<span class="sd">        be retrieved from the Context flyweight cache.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[:class:`ways.api.Context`]: Every Context object found by Ways.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">contexts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">used_hierarchy_assignment_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">ways</span><span class="o">.</span><span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pair</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_hierarchy_assignment_pairs</span><span class="p">:</span>
                <span class="n">used_hierarchy_assignment_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
                <span class="n">contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_context</span><span class="p">(</span><span class="n">hierarchy</span><span class="o">=</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">contexts</span></div>


<div class="viewcode-block" id="get_context"><a class="viewcode-back" href="../../../situation.html#ways.api.get_context">[docs]</a><span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span>
                <span class="n">assignment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">follow_alias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get a persistent Context at some hierarchy/assignment location.</span>

<span class="sd">    This function uses a Flyweight factory to manage the instance objects</span>
<span class="sd">    that it returns.</span>

<span class="sd">    Reference:</span>
<span class="sd">        http://sourcemaking.com/design_patterns/flyweight</span>
<span class="sd">        http://sourcemaking.com/design_patterns/flyweight/python/1</span>

<span class="sd">    Args:</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The location to look for our instance.</span>
<span class="sd">        assignment (str):</span>
<span class="sd">            The category/grouping of the instance. If no assignment is given,</span>
<span class="sd">            Ways will gather plugins in the order defined in the</span>
<span class="sd">            WAYS_PRIORITY environment variable and create plugins</span>
<span class="sd">            based on that.</span>
<span class="sd">        *args (list):</span>
<span class="sd">            If an object instance is found at the hierarchy/assignment,</span>
<span class="sd">            this gets passed to the instantiation of that object.</span>
<span class="sd">        **kwargs (dict[str]):</span>
<span class="sd">            If an object instance is found at the hierarchy/assignment,</span>
<span class="sd">            this gets passed to the instantiation of that object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        &lt;class_tuple instance&gt; or NoneType:</span>
<span class="sd">            An instance of that class. If the Context that is</span>
<span class="sd">            queried doesn&#39;t have any Plugin objects defined for it, it&#39;s</span>
<span class="sd">            considered &#39;empty&#39;. To avoid faults in our code,</span>
<span class="sd">            we return None.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">__FACTORY</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span>
        <span class="n">hierarchy</span><span class="p">,</span>
        <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">,</span>
        <span class="n">follow_alias</span><span class="o">=</span><span class="n">follow_alias</span><span class="p">,</span>
        <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_current_platform"><a class="viewcode-back" href="../../../situation.html#ways.api.get_current_platform">[docs]</a><span class="k">def</span> <span class="nf">get_current_platform</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Get the user-defined platform for Ways.</span>

<span class="sd">    If WAYS_PLATFORM is not defined, the user&#39;s system OS is returned instead.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The platform.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">system_platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">PLATFORM_ENV_VAR</span><span class="p">,</span> <span class="n">system_platform</span><span class="p">)</span></div>


<div class="viewcode-block" id="register_context_alias"><a class="viewcode-back" href="../../../situation.html#ways.api.register_context_alias">[docs]</a><span class="k">def</span> <span class="nf">register_context_alias</span><span class="p">(</span><span class="n">alias_hierarchy</span><span class="p">,</span> <span class="n">old_hierarchy</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set a hierarchy to track the changes of another hierarchy.</span>

<span class="sd">    This function lets you refer to plugins and Context objects</span>
<span class="sd">    without specifying their full names.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; class SomePlugin(plugin.Plugin):</span>
<span class="sd">        &gt;&gt;&gt;     def get_mapping(self):</span>
<span class="sd">        &gt;&gt;&gt;         return &#39;/some/path/here&#39;</span>

<span class="sd">        &gt;&gt;&gt;     def get_hierarchy(self):</span>
<span class="sd">        &gt;&gt;&gt;         return (&#39;nuke&#39;, &#39;scenes&#39;)</span>

<span class="sd">        &gt;&gt;&gt;     def get_platforms(self):</span>
<span class="sd">        &gt;&gt;&gt;         return &#39;*&#39;</span>

<span class="sd">        &gt;&gt;&gt; class AnotherPlugin(plugin.Plugin):</span>
<span class="sd">        &gt;&gt;&gt;     def get_mapping(self):</span>
<span class="sd">        &gt;&gt;&gt;         return &#39;/some/path/here&#39;</span>

<span class="sd">        &gt;&gt;&gt;     def get_hierarchy(self):</span>
<span class="sd">        &gt;&gt;&gt;         return (&#39;maya&#39;, &#39;scenes&#39;)</span>

<span class="sd">        &gt;&gt;&gt;     def get_platforms(self):</span>
<span class="sd">        &gt;&gt;&gt;         return &#39;*&#39;</span>

<span class="sd">        &gt;&gt;&gt; sit.register_context_alias(&#39;maya_scenes&#39;, &#39;maya/scenes&#39;)</span>
<span class="sd">        &gt;&gt;&gt; context = ways.api.get_context(&#39;maya_scenes&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # The resulting Context object has the hierarchy (&#39;maya_scenes&#39;, )</span>
<span class="sd">        &gt;&gt;&gt; # but has all of the plugins from &#39;maya/scenes&#39;</span>

<span class="sd">        &gt;&gt;&gt; sit.register_context_alias(&#39;maya_scenes&#39;, &#39;nuke/scenes&#39;)</span>

<span class="sd">        &gt;&gt;&gt; # Now, the Context(&#39;maya_scenes&#39;) is pointing to a Nuke Context</span>
<span class="sd">        &gt;&gt;&gt; # we can immediately work with this Context without having to</span>
<span class="sd">        &gt;&gt;&gt; # re-instantiate the Context</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:</span>
<span class="sd">            If the alias is the same as the hierarchy that it&#39;s trying to</span>
<span class="sd">            be aliased to or if the alias was already defined.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">old_hierarchy</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">split_hierarchy</span><span class="p">(</span><span class="n">old_hierarchy</span><span class="p">)</span>
    <span class="n">alias_hierarchy</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">split_hierarchy</span><span class="p">(</span><span class="n">alias_hierarchy</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">old_hierarchy</span> <span class="o">==</span> <span class="n">alias_hierarchy</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Hierarchy: &quot;</span><span class="si">{hier}</span><span class="s1">&quot; cannot be aliased to itself&#39;</span>
                         <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hier</span><span class="o">=</span><span class="n">old_hierarchy</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">alias_hierarchy</span> <span class="ow">in</span> <span class="n">__FACTORY</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Alias: &quot;</span><span class="si">{alias}</span><span class="s1">&quot; was already defined.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">alias</span><span class="o">=</span><span class="n">alias_hierarchy</span><span class="p">))</span>

    <span class="n">__FACTORY</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">alias_hierarchy</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_hierarchy</span>

    <span class="c1"># Link the plugins from the old hierarchy to our alias</span>
    <span class="c1"># so that your plugin cache now has two keys that both point to the same</span>
    <span class="c1"># list</span>
    <span class="c1">#</span>
    <span class="c1"># We do this so that, if needed, users can call a Context explicitly by its</span>
    <span class="c1"># alias name, directly, or have the option to &quot;follow&quot; the alias back to its</span>
    <span class="c1"># base plugin hierarchy.</span>
    <span class="c1">#</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
        <span class="n">old_hierarchy</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">())</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">][</span><span class="n">alias_hierarchy</span><span class="p">]</span> <span class="o">=</span> \
        <span class="n">ways</span><span class="o">.</span><span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">][</span><span class="n">old_hierarchy</span><span class="p">]</span></div>


<div class="viewcode-block" id="resolve_alias"><a class="viewcode-back" href="../../../situation.html#ways.api.resolve_alias">[docs]</a><span class="k">def</span> <span class="nf">resolve_alias</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the real hierarchy that the given alias represents.</span>

<span class="sd">    Args:</span>
<span class="sd">        hierarchy (iter[str] or str): The alias hierarchy to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str]: The real hierarchy.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">__FACTORY</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">)</span></div>


<div class="viewcode-block" id="clear_aliases"><a class="viewcode-back" href="../../../situation.html#ways.api.clear_aliases">[docs]</a><span class="k">def</span> <span class="nf">clear_aliases</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Remove all the stored aliases in this instance.&#39;&#39;&#39;</span>
    <span class="n">__FACTORY</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<div class="viewcode-block" id="clear_contexts"><a class="viewcode-back" href="../../../situation.html#ways.api.clear_contexts">[docs]</a><span class="k">def</span> <span class="nf">clear_contexts</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Remove every Context instance that this object knows about.</span>

<span class="sd">    If a Context is re-queried after this method is run, a new instance</span>
<span class="sd">    for the Context will be created and returned.</span>

<span class="sd">    Running this method is not recommended because it messes with the</span>
<span class="sd">    internals of Ways.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__FACTORY</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Colin Kennedy

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>