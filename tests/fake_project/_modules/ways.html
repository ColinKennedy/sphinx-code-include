

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ways &mdash; Ways 1.0.0b1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'1.0.0b1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ways
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../why.html">Why</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../descriptors.html">Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugin_basics.html">Plugin Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugin_advanced.html">Advanced Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parsing.html">Parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_details.html">API Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../common_patterns.html">Common Patterns And Best Practices</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../summary.html">API Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ways.html">API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ways</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>ways</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ways</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&#39;&#39;&#39;The main location where loaded plugin and action objects are managed.&#39;&#39;&#39;</span>

<span class="c1"># IMPORT STANDARD LIBRARIES</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="c1"># IMPORT THIRD-PARTY LIBRARIES</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="c1"># IMPORT LOCAL LIBRARIES</span>
<span class="kn">from</span> <span class="nn">.base</span> <span class="k">import</span> <span class="n">finder</span>
<span class="kn">from</span> <span class="nn">.base</span> <span class="k">import</span> <span class="n">situation</span> <span class="k">as</span> <span class="n">sit</span>
<span class="kn">from</span> <span class="nn">.helper</span> <span class="k">import</span> <span class="n">common</span>
<span class="kn">from</span> <span class="nn">.parsing</span> <span class="k">import</span> <span class="n">registry</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0b1&quot;</span>


<span class="n">ACTION_CACHE</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">DESCRIPTORS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">DESCRIPTOR_LOAD_RESULTS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">PLUGIN_CACHE</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">PLUGIN_LOAD_RESULTS</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">_get_actions</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the actions defined for a plugin hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The specific description to get plugin/action objects from.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The group to get items from. Default: &#39;master&#39;.</span>
<span class="sd">        duplicates (:obj:`bool`, optional):</span>
<span class="sd">            If True, The first Action that is found will be returned.</span>
<span class="sd">            If False, all actions (including parent actions with the same</span>
<span class="sd">            name) are all returned. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[list[str], list[:class:`ways.api.Action` or callable]]:</span>
<span class="sd">            0: All of the names of each action that was found.</span>
<span class="sd">            1: The object that was created for a specific action.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">action_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">actions</span> <span class="ow">in</span> <span class="n">get_actions_iter</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">actions</span><span class="p">):</span>
            <span class="n">is_a_new_action</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action_names</span>

            <span class="k">if</span> <span class="n">is_a_new_action</span> <span class="ow">or</span> <span class="n">duplicates</span><span class="p">:</span>
                <span class="n">action_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action_names</span><span class="p">,</span> <span class="n">objects</span>


<span class="k">def</span> <span class="nf">_get_from_assignment</span><span class="p">(</span><span class="n">obj_cache</span><span class="p">,</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get a plugin from some hierarchy and assignment, if it exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj_cache (dict[str, dict[str]]):</span>
<span class="sd">            Some mapping object that contains details that</span>
<span class="sd">            hierarchy and assignment will try to access.</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The specific description to get plugin/action objects from.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The group to get items from. Default: &#39;master&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The output of the assignment, if any. Ideally, a dict.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj_cache</span><span class="p">[</span><span class="n">hierarchy</span><span class="p">][</span><span class="n">assignment</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>


<div class="viewcode-block" id="get_actions"><a class="viewcode-back" href="../ways.html#ways.get_actions">[docs]</a><span class="k">def</span> <span class="nf">get_actions</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get back all of the action objects for a plugin hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The specific description to get plugin/action objects from.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The group to get items from. Default: &#39;master&#39;.</span>
<span class="sd">        duplicates (:obj:`bool`, optional):</span>
<span class="sd">            If True, The first Action that is found will be returned.</span>
<span class="sd">            If False, all actions (including parent actions with the same</span>
<span class="sd">            name) are all returned. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[:class:`ways.api.Action` or callable]:</span>
<span class="sd">            The actions in the hierarchy.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">action_objects_index</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">actions</span> <span class="o">=</span> <span class="n">_get_actions</span><span class="p">(</span>
        <span class="n">hierarchy</span><span class="o">=</span><span class="n">hierarchy</span><span class="p">,</span>
        <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">,</span>
        <span class="n">duplicates</span><span class="o">=</span><span class="n">duplicates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">actions</span><span class="p">[</span><span class="n">action_objects_index</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_actions_iter"><a class="viewcode-back" href="../ways.html#ways.get_actions_iter">[docs]</a><span class="k">def</span> <span class="nf">get_actions_iter</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the actions at a particular hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The location of where this Plugin object is.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The group that the PLugin was assigned to. Default: &#39;master&#39;.</span>
<span class="sd">            If assignment=&#39;&#39;, all plugins from every assignment is queried.</span>

<span class="sd">    Yields:</span>
<span class="sd">        dict[str, :class:`ways.api.Action`]:</span>
<span class="sd">            The actions for some hierarchy.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_search_for_item</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find the first action in our cache that we can find.&#39;&#39;&#39;</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="n">get_priority</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">priority</span><span class="p">:</span>
            <span class="c1"># As a fallback if get_priority gives us nothing, just use the</span>
            <span class="c1"># actions in the order that they were added</span>
            <span class="c1">#</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="n">ACTION_CACHE</span><span class="p">[</span><span class="n">hierarchy</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="n">priority</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ACTION_CACHE</span><span class="p">[</span><span class="n">hierarchy</span><span class="p">][</span><span class="n">assignment</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">continue</span>

    <span class="c1"># The use of &#39;not assignment&#39; is very intentional. Do not change</span>
    <span class="c1">#</span>
    <span class="c1"># Excluding an assignment is a very explicit decision, because the</span>
    <span class="c1"># default assignment value is &#39;master&#39;. Sending assignment=&#39;&#39; means that</span>
    <span class="c1"># the user wants to consider all assignments, not one specifically.</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">assignment</span><span class="p">:</span>
        <span class="n">assignment_method</span> <span class="o">=</span> <span class="n">_search_for_item</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">assignment_method</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Create a simple partial method that only takes hierarchy.&#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="n">_get_from_assignment</span><span class="p">(</span>
                <span class="n">obj_cache</span><span class="o">=</span><span class="n">ACTION_CACHE</span><span class="p">,</span>
                <span class="n">hierarchy</span><span class="o">=</span><span class="n">hierarchy</span><span class="p">,</span>
                <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">)</span>

    <span class="c1"># This iterates over a hierarchy from bottom to top and returns the</span>
    <span class="c1"># first action it finds. It&#39;s a very different behavior than get_plugins</span>
    <span class="c1">#</span>
    <span class="n">hierarchy_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">hierarchy_len</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">assignment_method</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">[:</span><span class="n">hierarchy_len</span> <span class="o">-</span> <span class="n">index</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">continue</span></div>


<div class="viewcode-block" id="get_action_names"><a class="viewcode-back" href="../ways.html#ways.get_action_names">[docs]</a><span class="k">def</span> <span class="nf">get_action_names</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the names of all actions available for some plugin hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The specific description to get plugin/action objects from.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The group to get items from. Default: &#39;master&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: The names of all actions found for the Ways object.</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">action_names_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">_get_actions</span><span class="p">(</span><span class="n">hierarchy</span><span class="o">=</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="n">action_names_index</span><span class="p">]:</span>
        <span class="c1"># Maintain definition order but also make sure they are all unique</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">names</span></div>


<div class="viewcode-block" id="get_actions_info"><a class="viewcode-back" href="../ways.html#ways.get_actions_info">[docs]</a><span class="k">def</span> <span class="nf">get_actions_info</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Get the names and objects for all Action objects in a hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The specific description to get plugin/action objects from.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The group to get items from. Default: &#39;master&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str: :class:`ways.api.Action` or callable]:</span>
<span class="sd">            The name of the action and its associated object.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">_get_actions</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
        <span class="n">actions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">return</span> <span class="n">actions</span></div>


<div class="viewcode-block" id="get_action"><a class="viewcode-back" href="../ways.html#ways.get_action">[docs]</a><span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find an action based on its name, hierarchy, and assignment.</span>

<span class="sd">    The first action that is found for the hierarchy is returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the action to get. This name is assigned to</span>
<span class="sd">                    the action when it is defined.</span>
<span class="sd">        hierarchy (tuple[str]): The location of where this Action object is.</span>
<span class="sd">        assignment (:obj:`str`, optional): The group that the Action was</span>
<span class="sd">                                            assigned to. Default: &#39;master&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :class:`ways.api.Action` or NoneType: The found Action object.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">actions</span> <span class="ow">in</span> <span class="n">get_actions_iter</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">actions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>  <span class="c1"># TypeError in case action is None</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="get_known_platfoms"><a class="viewcode-back" href="../ways.html#ways.get_known_platfoms">[docs]</a><span class="k">def</span> <span class="nf">get_known_platfoms</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Find the platforms that Ways sees.</span>

<span class="sd">    This will return back the platforms defined in the WAYS_PLATFORMS</span>
<span class="sd">    environment variable. If WAYS_PLATFORMS isn&#39;t defined, a default set of</span>
<span class="sd">    platforms is returned.</span>

<span class="sd">    Returns:</span>
<span class="sd">        set[str]: All of the platforms.</span>
<span class="sd">                  Default: {&#39;darwin&#39;, &#39;java&#39;, &#39;linux&#39;, &#39;windows&#39;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">common</span><span class="o">.</span><span class="n">PLATFORMS_ENV_VAR</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># These platforms are the what platform.system() could return</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;darwin&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">,</span> <span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="s1">&#39;windows&#39;</span><span class="p">}</span></div>


<div class="viewcode-block" id="get_plugins"><a class="viewcode-back" href="../ways.html#ways.get_plugins">[docs]</a><span class="k">def</span> <span class="nf">get_plugins</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find an plugin based on its name, hierarchy, and assignment.</span>

<span class="sd">    Every plugin found at every level of the given hierarchy is collected</span>
<span class="sd">    and returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str):</span>
<span class="sd">            The name of the plugin to get. This name needs to be assigned</span>
<span class="sd">            to the plugin when it is defined.</span>
<span class="sd">        hierarchy (tuple[str]):</span>
<span class="sd">            The location of where this Plugin object is.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The group that the PLugin was assigned to. Default: &#39;master&#39;.</span>
<span class="sd">            If assignment=&#39;&#39;, all plugins from every assignment is queried.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[:class:`ways.api.Plugin`]:</span>
<span class="sd">            The found plugins, if any.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_search_for_plugin</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find all plugins in some hierarchy for every assignment.&#39;&#39;&#39;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="n">get_priority</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">][</span><span class="n">hierarchy</span><span class="p">][</span><span class="n">assignment</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">items</span>

    <span class="c1"># The use of &#39;not assignment&#39; is very intentional. Do not change</span>
    <span class="c1">#</span>
    <span class="c1"># Excluding an assignment is a very explicit decision, because the</span>
    <span class="c1"># default assignment value is &#39;master&#39;. Sending assignment=&#39;&#39; means that</span>
    <span class="c1"># the user wants to consider all assignments, not one specifically.</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">assignment</span><span class="p">:</span>
        <span class="n">assignment_method</span> <span class="o">=</span> <span class="n">_search_for_plugin</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">assignment_method</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Create a scoped function that only need hierarchy as input.&#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="n">_get_from_assignment</span><span class="p">(</span>
                <span class="n">obj_cache</span><span class="o">=</span><span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">],</span>
                <span class="n">hierarchy</span><span class="o">=</span><span class="n">hierarchy</span><span class="p">,</span>
                <span class="n">assignment</span><span class="o">=</span><span class="n">assignment</span><span class="p">)</span>

    <span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">sit</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">)</span>

    <span class="c1"># This iterates over a hierarchy from top to bottom and gets every</span>
    <span class="c1"># plugin at each level of the hierarchy that it finds.</span>
    <span class="c1">#</span>
    <span class="c1"># So, for example</span>
    <span class="c1"># (&#39;some&#39;, &#39;hierarchy&#39;, &#39;here&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># Will get the plugins for (&#39;some&#39;, ),</span>
    <span class="c1"># then the plugins for (&#39;some&#39;, &#39;hierarchy&#39;),</span>
    <span class="c1"># and finally plugins for (&#39;some&#39;, &#39;hierarchy&#39;, &#39;here&#39;)</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">)):</span>
        <span class="n">plugins</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">assignment_method</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">[:</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">plugins</span></div>


<div class="viewcode-block" id="get_parse_order"><a class="viewcode-back" href="../ways.html#ways.get_parse_order">[docs]</a><span class="k">def</span> <span class="nf">get_parse_order</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;list[str]: The order to try all of the parsers registered by the user.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">PARSERS_ENV_VAR</span><span class="p">,</span> <span class="s1">&#39;regex&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_priority"><a class="viewcode-back" href="../ways.html#ways.get_priority">[docs]</a><span class="k">def</span> <span class="nf">get_priority</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Determine the order that assignments are searched through for plugins.</span>

<span class="sd">    This list is controlled by the WAYS_PRIORITY variable.</span>

<span class="sd">    For example, os.environ[&#39;WAYS_PRIORITY&#39;] = &#39;master:job&#39;.</span>
<span class="sd">    Since job plugins come after master plugins, they are given</span>
<span class="sd">    higher priority</span>

<span class="sd">    Todo:</span>
<span class="sd">        Give a recommendation (in docs) for where to read more about this.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str]: The assignments to search through.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">PRIORITY_ENV_VAR</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">DEFAULT_ASSIGNMENT</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span></div>


<div class="viewcode-block" id="add_plugin"><a class="viewcode-back" href="../ways.html#ways.add_plugin">[docs]</a><span class="k">def</span> <span class="nf">add_plugin</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="s1">&#39;master&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Add a plugin to Ways.</span>

<span class="sd">    Args:</span>
<span class="sd">        plugin (:class:`ways.api.Plugin`):</span>
<span class="sd">            The plugin to add.</span>
<span class="sd">        assignment (:obj:`str`, optional):</span>
<span class="sd">            The assignment of the plugin. Default: &#39;master&#39;.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Set defaults (if needed)</span>
    <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">get_hierarchy</span><span class="p">()</span>

    <span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">())</span>
    <span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">][</span><span class="n">hierarchy</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">assignment</span><span class="p">,</span> <span class="p">[])</span>

    <span class="c1"># Add the plugin if it doesn&#39;t already exist</span>
    <span class="k">if</span> <span class="n">plugin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
        <span class="n">check_plugin_uuid</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>

        <span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">][</span><span class="n">plugin</span><span class="o">.</span><span class="n">get_hierarchy</span><span class="p">()][</span><span class="n">assignment</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
        <span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_plugin_uuid"><a class="viewcode-back" href="../ways.html#ways.check_plugin_uuid">[docs]</a><span class="k">def</span> <span class="nf">check_plugin_uuid</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Make sure that the plugin UUID is not already taken.</span>

<span class="sd">    Args:</span>
<span class="sd">        info (:class:`ways.api.DataPlugin` or dict[str]):</span>
<span class="sd">            Data that may become a proper plugin.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError:</span>
<span class="sd">            If the plugin&#39;s UUID is already taken.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">uuids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">cached_plugin</span> <span class="ow">in</span> <span class="n">PLUGIN_CACHE</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plugin_uuid</span> <span class="o">=</span> <span class="n">cached_plugin</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">plugin_uuid</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">plugin_uuid</span><span class="p">:</span>
            <span class="n">uuids</span><span class="p">[</span><span class="n">plugin_uuid</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_plugin</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">plugin_uuid</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">plugin_uuid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="n">uuids</span><span class="p">[</span><span class="n">plugin_uuid</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">cached</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">info</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
        <span class="s1">&#39;UUID: &quot;</span><span class="si">{uuid_}</span><span class="s1">&quot; is already taken by plugin, &quot;</span><span class="si">{plug}</span><span class="s1">&quot;. Please choose &#39;</span>
        <span class="s1">&#39;another name. Info: &quot;</span><span class="si">{info}</span><span class="s1">&quot; is invalid.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">uuid_</span><span class="o">=</span><span class="n">plugin_uuid</span><span class="p">,</span> <span class="n">plug</span><span class="o">=</span><span class="n">cached</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">))</span></div>


<div class="viewcode-block" id="clear"><a class="viewcode-back" href="../ways.html#ways.clear">[docs]</a><span class="k">def</span> <span class="nf">clear</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Remove all Ways plugins and actions.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">reset_cache</span><span class="p">(</span><span class="n">cache</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reset some dict cache.&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">cache</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ACTION_CACHE</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">reset_cache</span><span class="p">(</span><span class="n">PLUGIN_CACHE</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">PLUGIN_LOAD_RESULTS</span><span class="p">[:]</span>
    <span class="k">del</span> <span class="n">DESCRIPTOR_LOAD_RESULTS</span><span class="p">[:]</span>
    <span class="k">del</span> <span class="n">DESCRIPTORS</span><span class="p">[:]</span>
    <span class="n">finder</span><span class="o">.</span><span class="n">Find</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">sit</span><span class="o">.</span><span class="n">clear_aliases</span><span class="p">()</span>
    <span class="n">sit</span><span class="o">.</span><span class="n">clear_contexts</span><span class="p">()</span>
    <span class="n">registry</span><span class="o">.</span><span class="n">reset_asset_classes</span><span class="p">()</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Colin Kennedy

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>